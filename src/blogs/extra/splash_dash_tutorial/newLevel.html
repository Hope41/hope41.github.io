<title>New Level | Joachim Ford</title>
<link rel = icon type = image/x-icon  href = /favs/favicon.ico>
<canvas id=c></canvas>
<script>
l=_=>{
W=c.width=innerWidth-16
H=c.height=innerHeight-16

// Get current player pos
D=d
E=e

// Move player
g&v?f=-.18:e+=f+=.007
h?d-=.1:j?d+=.1:0

// Get the average size of the webpage by adding the width and height together
z=(W+H)/25

// Make a function the draws rectangles
r=(x,y,s)=>X.fillRect((x-d)*z+W/2,(y-e)*z+H/2,z*s,z*s)

// Before the check, say the player is in the air
v=0

// Detect and resolve collision
A(d,e+.5)&!A(d,e)|A(d+.5,e+.5)&!A(d+.5,e)&&(e+.5)%1<f&&(e=E,v=1,f=0) // Ground
A(d,e)|A(d+.5,e)|A(d,e+.5)|A(d+.5,e+.5)|d<0|d+.5>70&&(d=D,A(d,e)|A(d+.5,e)&&(f=0,e=E)) // Wall and Ceiling

// Coin collision
e<17&!A(d,e)&a(d,e)>-1&&(k[~~d*~~e]=1)

// Make some ground
// Make a number to count the remaining coins
K=0
for(x=70;x--;){ // Start at 70 and count down
    for(y=30;y--;){ // Start at 30 and count down
        X.fillStyle='#'+~(Math.sin(x)*5-543)
        // Increase the coin count
        A(x,y)?r(x,y,.9):a(x,y)>-1&y<17&!k[x*y]&&(X.fillStyle='#bb0',r(x+.4,y+.4+Math.sin(_/50+x+K++)*.1,.3))
    }
}

X.fillStyle='#034' // Body colour
r(d,e+f,.4) // Body
r(d,e+.4,.1) // Left foot
r(d+.3,e+.4,.1) // Right foot

X.fillStyle='#0698'
for(i=634;i-=2;X.lineTo((i/9-d)*z+W/2,(J[i]+13-e)*z+H/2)){
if(!_)J.push(0,0)
else{
J[i]+=J[i+1]*(i>3)
J[i+1]+=(J[i-1]+Math.sin(_*J[i+1])*.02-J[i+1])/2
~d==~(i/9)&e>12&e<14?J[i+1]+=f/4:J[i+1]*=.97*(i<630)
J[i+1]-=J[i]/25
}}
r(0,13,70)
X.fill()

// Detect when there are no more coins left and reset the player's position
!K?k=[Q+=d=e=1]:0

requestAnimationFrame(l)
}
X=c.getContext`2d`

// Add a new number "v"
d=e=g=h=j=f=v=Q=0

// Create an array to store collected coins
k=[J=[]]

// Detect key presses
P=(e,b)=>e.keyCode==38|e.keyCode==87?g=b:e.keyCode==39|e.keyCode==68?j=b:e.keyCode==37|e.keyCode==65?h=b:0
onkeydown=e=>P(e,1)
onkeyup=e=>P(e)

// Create two new functions
// a(x, y) gives you a decimal based on the given block coordinates
// A(x, y) gives you a boolean based on the given block coordinates
a=(x,y)=>{x=~~x+1,y=~~y;return (Math.sin(y*x*9+Q)*6)+y-15}
A=(x,y)=>a(x,y)>0

l()
</script>