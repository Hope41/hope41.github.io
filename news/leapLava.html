<!DOCTYPE html>
<html>
    <head>
        <meta charset = utf-8>
        <meta name = viewport content = 'width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no'>

        <style>
            body {
                background: #fff;
                margin: 0;
                overflow: hidden
            }

            canvas {
                width: 100%;
                height: 100%;
                user-select: none;
                -webkit-touch-callout: none;
                -webkit-user-select: none
            }
        </style>
    </head>
    <body>
        <canvas id = a></canvas>

        <script>
            const c = a.getContext('2d')
            const resize = () => {
                a.width = innerWidth
                a.height = innerHeight
            }
            addEventListener('resize', resize)
            resize()

            // ~~~ ENTRY ~~~

            S=Math.sin
            R=_=>{
            w=a.width
            h=a.height

            // death
            Y>v+99?(k=0,H++):(A-=(A-h/2-X)/25,t+=.2)
            B-=(B-Y+99)/15

            // ominous haze
            for(i=0;++i<99;){
            c[Z='fillStyle']=`rgb(${S(i/20)*99},0,0)`
            c[f='fillRect'](0,i*5,w,h)
            }

            // buildings
            for(i=0;++i<60;){
            s=i*i/12
            o=S(i)*w/s
            Q=w+s
            r=((w/2-s/2+o*s-A/300*s)%Q+Q)%Q-s
            c[f](r,h/2-B/400*s,s,-h+B)
            c[Z]=i<59?`rgb(${i},${i},${i})`:'#000'}

            // hero
            Y+=y
            Y>0|I?k.u?y=-12:(Y>0?Y=0:y=0):y+=.4
            c[f](p=X+h-A,q=Y+h/2-99-B,50,99)
            c[Z]='#fff'
            c[f](p+8,q+9,14,14)
            c[f](p+29,q+9,14,14)
            k.r?X+=4:k.l?X-=4:0

            // blocks
            I=0
            for(i=~~((A-w)/60);i<~~((A+w)/60);i++){
            d=h-A+i*60
            e=(S((O=i%999)*O)<.6|(b=i%30==0))&i>0&&(S(i*i)+i)*20-~(i/30)*i*2-(b&&i+S(i+(t/(i/15)))*i/.7)
            E=-B+h/2-e
            p>d-50&p<d+60&q>E-99&&(D=-q+(E-99),D<-9-y*5?X+=p-d>0?4:-4:(Y+=D-y,I=1))
            c[f](d,E,60,e)
            }

            c.font='3em"'

            // lava
            c[Z]='#f40c'
            c[f](0,-B+h/2,w,v>0?v=0:v-=(W=.2+S(t/30)*.3+t/240)<2.4?W:2.4)

            // eyes
            c[f](p+16,q+14,5,5)
            c[f](p+37,q+14,5,5)

            // glow
            c[Z]=`rgb(99,9,0,${.6-(v-B)/3e3})`
            c[f](0,0,w,h)

            c[Z]='#fff'
            c.fillText(t<2048&&k?~~t:(H++,k==0?'LOSE':(v=0,'WIN!')),9,45)
            requestAnimationFrame(R)
            }

            t=y=X=I=H=v=1
            Y=-10
            A=B=-500

            k={}
            P=(e,b)=>{(q=e.keyCode)==38|q==90|q==87?k.u=b:0
            q==39|q==68?k.r=b:q==37|q==65|q==81?k.l=b:0}
            onkeydown=e=>P(e,1)
            onkeyup=e=>P(e)
            R()
        </script>
    </body>
</html>