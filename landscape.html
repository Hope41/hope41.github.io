<!DOCTYPE html>
    <head>
        <title>Make A Psuedo 3D Landscape</title>

        <script src = main.js></script>
        <link rel = stylesheet href = main.css>
        <script async src = "https://www.googletagmanager.com/gtag/js?id=G-F1R0H0BSJE"></script>
    </head>

    <body>
        <section class = main>
            <h1>Make A Psuedo 3D Landscape</h1>

            <iframe src = demos/landscape1.html></iframe>
            
            Arrow keys to move
            <hr>

            <p></p>
            In this lesson, we will learn how to make a psuedo 3D world.
            First we will discuss how it works,
            and then we can go on to JavaScript code.
            <hr>
            1. The ground<br>
            Just making it clear, the ground is nothing complicated.<br>
            It is a green rectangle in the center of the screen.
            <hr>
            2. The trees<br>
            The trees are generated at the horizon width a very small width & height.<br>
            As the camera moves forward, their size steadily increases along width their<p></p>
            <span class = key>
            X position (the horizontal coordinate) and their<br>
            Y position (the vertical coordinate).
            </span>
            <p></p>
            The example below shows the positions changing and the coordinates

            <iframe src = demos/landscape2.html></iframe>
            
            <p></p>
            How do they move?
            First, get the distance the object is from the center of the screen.
<div class = code>
<pre>
Xdistance = object.x - screen.width &#xF7; 2
Ydistance = object.y - screen.height &#xF7; 2
</pre>
</div>
            Then, move the object based on its distance.
<div class = code>
<pre>
object.x += Xdistance &#215; speed // this means that the object will move [Xdistance &#215; speed] each frame
</pre>
</div>
            Let's define the speed as 0.01.<p></p>
            So if the Xdistance is 25,<br>
            then 25 &#215; 0.01 = 0.25<br>
            so the objects x position would move 0.25px each frame!
            <p></p>
            Let's do the same with the Y position.
<div class = code>
<pre>
object.x += Xdistance &#215; speed
object.y += Ydistance &#215; speed
</pre>
</div>
            Now. There is something missing! As you can see...

            <iframe src = demos/landscape3.html></iframe>

            <p></p>
            Let's make the size update.
<div class = code>
<pre>
object.size  &#215;= 1 + speed // this means the object will move [object.size &#215; (1 + speed)] each frame
object.x += Xdistance &#215; speed
object.y += Ydistance &#215; speed
</pre>
</div>
            <iframe src = demos/landscape4.html></iframe>

            <p></p>
            let's start the html.

<div class = code>
<pre>
&lt;!DOCTYPE html&gt;
    &lt;body&gt;
        &lt;script&gt;
            // JavaScript code goes here
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>

            Now, in our script tag, we will make the canvas to draw our world on.

<div class = code>
<pre>
document.body.style.margin = 0 // remove the default margin around the screen
document.body.style.overflow = 'hidden' // hide any scroll bars
let c = document.createElement('canvas') // define the canvas
let ctx = c.getContext('2d') // the ctx (or context) is the thing that enables you to draw on the canvas
document.body.appendChild(c) // add the canvas to the html page
</pre>
</div>
        Now let's make our values:
<div class = code>
<pre>
let key = {up: false, left: false, right: false}
let speed = 0.01
let obj = [] // the list where we will have our trees
</pre>
</div>
        Before we go any further let's make a resize function.<br>
        This means our game will be responsive.
        The green is the new code:<!--CODE: GREY WHEN _#_ is around it and blue [let, var and const]-->
<div class = code>
<pre>
<mark>addEventListener('resize', resize)</mark>
document.body.style.margin = 0
document.body.style.overflow = 'hidden'
let c = document.createElement('canvas')
</pre>
</div>
<div class = code>
<pre>
let speed = 0.01
let obj = []
<mark>
function resize() {
    c.width = innerWidth// set the canvas width
    c.height = innerHeight // set the canvas height
    obj = [] // clear the objects
}
resize()</mark>
</pre>
</div>
        Also, because it will be useful later on, let's to add a <span class = key>random(min, max)</span> function.

<div class = code>
<pre>
    c.height = innerHeight // set the canvas height
    obj = [] // clear the objects
}
<mark>
function random(min, max) {
    return (Math.random() * (max - min)) + min
}
</mark>
resize()
</pre>
</div>
        We've finished setting up!
        Now we need to start adding objects to our <span class = key>obj</span> list.<br>
        Let's begin with an <span class = key>objects()</span> function:

<div class = code>
<pre>
    return (Math.random() * (max - min)) + min
}
<mark>
function objects() {
    let x = random(0, c.width)
    let y = c.height / 2 + 1
    let size = 1

    obj.unshift({x, y, size}) // unshift adds to the start of the list
}</mark>

resize()
</pre>
</div>
        First, we defined <span class = key>x</span> as a random number between 0 and the canvas width.<br>
        We then defined <span class = key>y</span> as <span class = key>half the screen height + one</span><p></p>
        x = random horizontal<br>
        y = half of screen + 1<br>
        size = 1<p></p>
        In the example below, the size is exaggerated due to illustrative purposes<p></p>
        <iframe src = demos/landscape5.html></iframe>
        <p></p>
        We added <span class = key>+ 1</span> to <span class = key>y</span> because it means the objects will move down.<br>
        This may sound confusing but the idea is actually quite simple:<p></p>
        <iframe src = demos/landscape6.html></iframe>
        <iframe src = demos/landscape7.html></iframe>
        <iframe src = demos/landscape8.html></iframe>
        If you look back at the explanation of this again, you will see the <span class = key>Ydistance</span>.<br>
        The Ydistance is based from the center.<br>
        The <span class = key>y position</span> moves by the Ydistance.<p></p>
        If the <span class = key>Ydistance</span> is at 1, then the object can move down... as multiplying it by speed gets bigger.<br>
        However, if the <span class = key>Ydistance</span> is at 0, then no matter what you multiply to it, it <span class = key>remains zero</span>.
        Thats why on the 'Plus zero' example, the <span class = key>y position</span> didn't change.<p></p>

        The next part is pretty straight forward... we will just do the same calculations as stated earlier.<br>
        All we need is a loop that runs every frame to move our objects:

<div class = code>
<pre>
    let size = 1

    obj.unshift({x, y, size}) // unshift adds to the start of the list
}
<mark>
function loop() {
    // loop code
    
    requestAnimationFrame(loop)
}

loop()
</mark>
resize()
</pre>
</div>
        Let's start by making some code that creates an object (or tree) whenever there are less than 100 of them on the screen.<br>
<div class = code>
<pre>
function loop() {<mark>
    if (obj.length < 100) {
        objects() // call up objects function
    }</mark>

    requestAnimationFrame(loop)
}

loop()
resize()
</pre>
</div>
        Now we are making our objects, we can start drawing them and moving them:

<div class = code>
<pre>
function loop() {
    if (obj.length < 100) {
        objects() // call up objects function
    }
    <mark>
    for (let item of obj) {
        ctx.fillStyle = '#f00'
        ctx.fillRect(item.x, item.y, item.size, item.size)
    }</mark>
    requestAnimationFrame(loop)
}

loop()
resize()
</pre>
</div>
        This is what it looks like so far...
        <iframe src = demos/landscape9.html></iframe>

        Not overly impressive, but everything is set up so the next bit will be very simple.
<div class = code>
<pre>
function loop() {<mark>
    c.width = c.width // remember to clear the screen!</mark>

    if (obj.length < 100) {
        objects() // call up objects function
    }

    for (let item of obj) {<mark>
        let distx = item.x - c.width / 2 // x distance
        let disty = item.y - c.height / 2 // y distance

        item.size *= 1 + speed // update size
        item.x += distx * speed // update x
        item.y += disty * speed // update y</mark>

        ctx.fillStyle = '#f00'
        ctx.fillRect(item.x, item.y, item.size, item.size)
    }
    requestAnimationFrame(loop)
}

loop()
resize()
</pre>
</div>
        If the above code is confusing, look further up the page and you will see this already discussed.

        The only remaining things to do are:<br>
        1. Remove objects when they are not on the screen<br>
        2. Change the objects shape<br>
        3. Apply key pressing<p></p>

        &#10122; The first step is very easy:
<div class = code>
<pre>
        item.x += distx * speed // update x
        item.y += disty * speed // update y
        <mark>
        if (item.x > c.width || item.x < -item.size || item.y > c.height) {
            obj.splice(obj.indexOf(item), 1) // remove object from list
        }</mark>

        ctx.fillStyle = '#f00'
        ctx.fillRect(item.x, item.y, item.size, item.size)
    }
    requestAnimationFrame(loop)
</pre>
</div>
        <p></p>...And the result:<p></p>
        <iframe src = demos/landscape10.html></iframe>

        &#10123; The shape can be played around with.
        I will show you the tree shape but feel free to make your own version.<p></p>
<div class = code>
<pre>
        item.x += distx * speed // update x
        item.y += disty * speed // update y

        if (item.x > c.width || item.x < -item.size || item.y > c.height) {
            obj.splice(obj.indexOf(item), 1) // remove object from list
        }
        <mark>
        ctx.fillStyle = '#542'
        ctx.fillRect(item.x - item.size / 2, item.y, item.size, item.size * 4)
        ctx.fillStyle = '#050'
        ctx.fillRect(item.x - item.size * 2, item.y - item.size * 4, item.size * 4, item.size * 4)</mark>
    }
    requestAnimationFrame(loop)
</pre>
</div>
        <iframe src = demos/landscape11.html></iframe>
        <p></p>
        &#10124; Finally, lets do the key pressing.<br>
        At the top of your script, write the following code to make the computer listen out for keys:<p></p>

<div class = code>
<pre>
&lt;script&gt;<mark>
    addEventListener('keydown', press)
    addEventListener('keyup', release)</mark>
    addEventListener('resize', resize)
    document.body.style.margin = 0
    document.body.style.overflow = 'hidden'
    let c = document.createElement('canvas')
</pre>
</div>
        Now let's make two functions for handling the keys. <span class = key>Press</span> and <span class = key>release</span>:
<div class = code>
<pre>
    c.height = innerHeight
    obj = []
}
<mark>
function press() {
    if (event.key == 'ArrowUp') key.up = true
    if (event.key == 'ArrowLeft') key.left = true
    if (event.key == 'ArrowRight') key.right = true
}

function release() {
    if (event.key == 'ArrowUp') key.up = false
    if (event.key == 'ArrowLeft') key.left = false
    if (event.key == 'ArrowRight') key.right = false
}</mark>

function random(min, max) {
    return (Math.random() * (max - min)) + min
</pre>
</div>

        Our <span class = key>key</span> dictionary has already been set-up so everything is ready for the final bit:
<div class = code>
<pre>
for (let item of obj) {
    distx = item.x - c.width / 2
    disty = item.y - c.height / 2
<mark>
    if (key.up) {
        item.size *= 1 + speed
        item.x += distx * speed
        item.y += disty * speed
    }

    if (key.left) {
        item.x += 10
    }

    if (key.right) {
        item.x -= 10
    }</mark>

    if (item.x > c.width || item.x < -item.size || item.y > c.height) {
        obj.splice(obj.indexOf(item), 1)
    }

    ctx.fillStyle = '#542'
    ctx.fillRect(item.x - item.size / 2, item.y, item.size, item.size * 4)
</pre>
</div>
        <iframe src = demos/landscape12.html></iframe>

        That is the end of this lesson.<br>
        You can download the .html file <span class = key>here</span>.<p></p>

        <div class = code>
        Note: You may notice that when you press the left/right key, the trees aren't anywhere else around you.
        A way to solve this is by generating the trees between <span class = key>-c.width</span> and <span class = key>c.width * 2</span>,
        and then removing the trees like:<br>
<pre>
if (item.x > c.width <mark>* 2</mark> || item.x < -<mark>c.width * 2</mark> || item.y > c.height) {
    obj.splice(obj.indexOf(item), 1)
}
</pre>
        Instead of:
<pre>
if (item.x > c.width || item.x < -item.size || item.y > c.height) {
    obj.splice(obj.indexOf(item), 1)
}
</pre>
        </div>
        </section>
    </body>
</html>