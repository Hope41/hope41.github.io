<!DOCTYPE html>
    <body>
        <script>
            addEventListener('keydown', press)
            addEventListener('keyup', release)
            addEventListener('resize', resize)
            document.body.style.margin = 0
            document.body.style.overflow = 'hidden'
            let c = document.createElement('canvas')
            let ctx = c.getContext('2d')
            document.body.appendChild(c)

            let key = {left: false, right: false}
            let obj = []

            let speed = 0.06
            let perspective_x = c.width / 2
            let line_length = 20
            let tunnel_timer = 3000
            let light_timer = 70
            let city_timer = 5000
            let flat_timer = 20
            let field_of_view = 1.6
            let camera_height = 2

            let LL = line_length
            let TT = tunnel_timer
            let LT = light_timer
            let CT = city_timer
            let FT = flat_timer

            let flat_height = 10

            let turnx = 0
            let turny = 0

            function resize() {
                c.width = innerWidth
                c.height = innerHeight
                perspective_x = c.width / 2

                obj = []

                objects()
            }

            function press() {
                if (event.key == 'ArrowLeft') key.left = true
                if (event.key == 'ArrowRight') key.right = true
            }

            function release() {
                if (event.key == 'ArrowLeft') key.left = false
                if (event.key == 'ArrowRight') key.right = false
            }

            function random(min, max) {
                return (Math.random() * (max - min)) + min
            }

            function objects() {
                turnx += speed / 6
                turny += speed
                perspective_x += Math.sin(turnx) * 3

                let x = perspective_x
                let y = c.height / 2 + Math.sin(turny) * 20
                let size = 1

                // LINE
                let line = false
                LL -= speed * 100
                if (LL < 0) {
                    line = true
                    if (LL < -line_length) LL = line_length
                }

                // TUNNEL
                let tunnel = false
                TT -= speed * 100
                if (TT < 0) {
                    tunnel = true
                    if (TT < -tunnel_timer / 2) TT = tunnel_timer
                }

                // STREET LIGHT
                let light = false
                LT -= speed * 100
                if (LT < 0) {
                    light = true
                    LT = light_timer
                }

                // CITY
                let city = false
                CT -= speed * 100
                if (CT < 0) {
                    city = true
                    if (CT < -city_timer) CT = city_timer
                }

                // FLAT
                let flat = false
                FH = flat_height
                FT -= speed * 100
                if (FT < 0) {
                    flat = true
                    if (FT < -flat_timer) {
                        FT = flat_timer
                        flat_height = random(5, 15)
                    }
                }

                let color = Math.floor(random(100, 120))
                let mist = Math.floor(random(0, 2))

                obj.unshift({x, y, size, line, tunnel, light, color, mist, city, flat, FH})
            }

            function loop() {
                ctx.fillStyle = 'rgb(255, 255, 255, .2)'
                ctx.fillRect(0, 0, c.width, c.height)

                objects()

                for (let i of obj) {
                    let distx = perspective_x - c.width / 2

                    i.size *= 1 + speed * field_of_view
                    i.y += (i.size * camera_height) / 100

                    i.x += (distx * i.size) * (speed / 100)

                    if (key.left) {
                        i.x += c.width / 200

                        perspective_x += (c.width / 200) / obj.length
                    }
                    if (key.right) {
                        i.x -= c.width / 200

                        perspective_x -= (c.width / 200) / obj.length
                    }

                    // DRAW
                    ctx.fillStyle = '#666'
                    if (i.line) ctx.fillStyle = '#555'
                    ctx.fillRect(0, i.y + i.size / 10, c.width, i.size * 2)
                    ctx.fillStyle = '#444'
                    ctx.fillRect(i.x - i.size, i.y, i.size * 2, i.size * 2)
                    ctx.fillStyle = '#777'
                    if (i.line) ctx.fillStyle = '#666'
                    ctx.fillRect(i.x - i.size, i.y, i.size / 4, i.size * 2)
                    ctx.fillRect(i.x + i.size - i.size / 4, i.y, i.size / 4, i.size * 2)

                    if (i.line) {
                        ctx.fillStyle = '#fff'
                        ctx.fillRect(i.x - i.size / 8, i.y, i.size / 8, i.size * 2)
                    }
                    if (i.tunnel) {
                        ctx.fillStyle = 'rgb('+i.color / 1.2+','+i.color / 1.3+','+i.color / 1.5+', 0.6)'
                        ctx.fillRect(i.x - i.size * 1.5, i.y - i.size * 2, i.size * 2.5, i.size / 2)
                        ctx.fillRect(i.x - i.size, i.y - i.size * 2, -i.size / 2, i.size * 2)
                        ctx.fillRect(i.x + i.size, i.y - i.size * 2, i.size / 2, i.size * 2)
                    }

                    else if (i.light) {
                        ctx.fillStyle = '#777'
                        ctx.fillRect(i.x - i.size * 1.3, i.y - i.size * 2, i.size / 10, i.size * 3)
                        ctx.fillRect(i.x - i.size * 1.3, i.y - i.size * 2, i.size / 2, i.size / 10)
                        ctx.fillRect(i.x + i.size * 1.3, i.y - i.size * 2, i.size / 10, i.size * 3)
                        ctx.fillRect(i.x + i.size * 1.3 - i.size / 2 + i.size / 10, i.y - i.size * 2, i.size / 2, i.size / 10)

                        ctx.fillStyle = '#ff0'
                        ctx.fillRect(i.x - i.size * 1.3 + i.size / 8, i.y - i.size * 2 + i.size / 20, i.size / 3, i.size / 10)
                        ctx.fillRect(i.x + i.size * 1.3 - i.size / 2 + i.size / 7, i.y - i.size * 2 + i.size / 20, i.size / 3, i.size / 10)
                    }

                    if (i.flat && i.city) {
                        ctx.fillStyle = '#444'
                        ctx.fillRect(i.x + i.size * 3, i.y - i.size * i.FH, i.size * i.FH / 3, i.size * (i.FH + 1))
                        ctx.fillRect(i.x - i.size * 3 - i.size * i.FH / 3, i.y - i.size * i.FH, i.size * i.FH / 3, i.size * (i.FH + 1))
                    }

                    // MIST
                    if (i.mist == 0) {
                        ctx.fillStyle = 'rgb(255,255,255,.03)'
                        ctx.fillRect(0, 0, c.width, i.y)
                    }

                    if (i.y > c.height || i.y < 0) {
                        obj.splice(obj.indexOf(i), 1)
                    }
                }
                
                requestAnimationFrame(loop)
            }

            resize()
            loop()
        </script>
    </body>
</html>