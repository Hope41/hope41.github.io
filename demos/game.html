<!DOCTYPE html>
    <head>
        <meta charset = utf-8>
    </head>
    <body>
        <canvas id = c></canvas>
        <script>
            const SIZE = 300
            const HEIGHT = 20
            const SPEED = 3
            const DIFFICULTY_INCREASE = 0.1

            const SCORE = 0
            const LOSE = false
            const TOWER_Y = innerHeight - HEIGHT * 2
            const BEGIN = true

            let ctx = c.getContext('2d')

            let size = SIZE
            let speed = SPEED
            let tower = []
            let bubbles = []
            let score = SCORE
            let lose = LOSE
            let tower_y = TOWER_Y
            let begin = BEGIN

            function reset() {
                size = SIZE
                speed = SPEED
                tower = []
                bubbles = []
                score = SCORE
                lose = LOSE
                tower_y = TOWER_Y

                let x = innerWidth / 2 - size / 2
                let y = tower_y + HEIGHT
                let s = size
                let color = '#f00'
                tower.unshift({x, y, s, color})

                block()
                bubble(innerWidth / 100)
            }

            addEventListener('mousedown', () => {
                if (!lose && !begin) {
                    if (tower[0].x < tower[1].x) {
                        size = (tower[0].x + tower[0].s) - tower[1].x

                        tower[0].s = size
                        tower[0].x = tower[1].x
                    }

                    if (tower[0].x > tower[1].x) {
                        size = (tower[1].x + tower[1].s) - tower[0].x

                        tower[0].s = size
                    }

                    if (tower[0].x + tower[0].s < tower[1].x || tower[0].x > tower[1].x + tower[1].s) {
                        lose = true
                    }

                    else {
                        tower_y -= HEIGHT
                        block()
                        speed += DIFFICULTY_INCREASE
                        score ++
                    }
                }
                else {
                    begin = false
                    reset()
                }
            })

            addEventListener('resize', resize)

            function random(min, max) {
                return Math.round(Math.random() * (max - min) + min)
            }

            function block() {
                let x = -size
                let y = tower_y
                let s = size
                let color = '#'+Math.random().toString(16).substr(2,6)
                tower.unshift({x, y, s, color})
            }

            function bubble(amount) {
                for (let i = 0; i < amount; i ++) {
                    let x = random(0, innerWidth)
                    let y = random(0, innerHeight)
                    let s = random(10, 100)
                    let o = random(0, 10)

                    bubbles.push({x, y, s, o})
                }
            }

            function resize() {
                c.width = innerWidth
                c.height = innerHeight

                bubbles = []
                bubble(innerWidth / 100)

                let dist_x = innerWidth / 2 - (tower[tower.length - 1].x + tower[tower.length - 1].s / 2)

                for (let i of tower) {
                    i.x += dist_x
                }
            }

            function start() {
                document.body.style.background = '#fff'
                document.body.style.margin = 0
                document.body.style.overflow = 'hidden'
                c.style.background = '#8ff'

                reset()
                resize()
                loop()
            }

            function loop() {
                c.width = c.width

                let dist_y = innerHeight / 2 - (tower[0].y + HEIGHT)

                for (let i of bubbles) {
                    i.o += 0.01

                    ctx.beginPath()
                    ctx.fillStyle = 'rgb(255,255,255,' + Math.sin(i.o) * i.s / 100 + ')'
                    ctx.arc(i.x, i.y, i.s, 0, 7)
                    ctx.fill()

                    i.s += Math.sin(i.o) * i.s / 1000
                    if (i.s < 1) i.s = 1

                    if (!begin) i.y += (i.s * dist_y) / 100

                    if (i.y > innerHeight + i.s) i.y = -i.s
                    if (i.y < -i.s) i.y = innerHeight + i.s
                    if (i.x > innerWidth + i.s) i.x = -i.s
                    if (i.x < -i.s) i.x = innerWidth + i.s
                }

                if (begin) {
                    ctx.font = innerWidth / 100 + 'em arial'
                    ctx.fillStyle = '#fff3'
                    ctx.textAlign = 'center'
                    ctx.fillText('Start', innerWidth / 2, innerHeight / 2)
                    ctx.strokeText('Start', innerWidth / 2, innerHeight / 2)
                }

                else {
                    tower[0].x += speed

                    if (tower[0].x > innerWidth) {
                        tower[0].x = -tower[0].s
                    }

                    for (let i of tower) {
                        if (lose) {
                            if (tower.indexOf(i)) {
                                ctx.fillStyle = i.color
                                ctx.fillRect(i.x, i.y, i.s, HEIGHT)
                                ctx.strokeRect(i.x, i.y, i.s, HEIGHT)
                            }
                        }

                        else {
                            ctx.fillStyle = i.color
                            ctx.fillRect(i.x, i.y, i.s, HEIGHT)
                            ctx.strokeRect(i.x, i.y, i.s, HEIGHT)
                        }

                        i.y += dist_y / 10
                    }
                    tower_y += dist_y / 10

                    ctx.fillStyle = '#000'
                    ctx.font = innerWidth / 500 + 'em arial'
                    ctx.fillText(score, 0, (innerWidth / 500) * 14)

                    if (lose) {
                        ctx.font = innerWidth / 100 + 'em arial'
                        ctx.fillStyle = '#fff3'
                        ctx.textAlign = 'center'
                        ctx.fillText('Game over', innerWidth / 2, innerHeight / 2)
                        ctx.strokeText('Game over', innerWidth / 2, innerHeight / 2)
                    }
                }

                requestAnimationFrame(loop)
            }

            start()
        </script>
    </body>
</html>