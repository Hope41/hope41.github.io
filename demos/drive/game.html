<!DOCTYPE html>
    <head>
        <meta charset = utf-8>
    </head>
    <body>
        <canvas id = c></canvas>
        <script>
            let ctx = c.getContext('2d')

            let segments = []
            let cars = []
            let key = {up: false, left: false, right: false}
            let point_x = innerWidth / 2 // define offset (the point where segments are emitted)
            let point_y = innerHeight / 2

            let resolution = 0

            let speed = 0.1
            let camera_height = 0.2

            let line_length = 5
            let line_width = 20

            let curve_amount = innerWidth / 100
            let curve_insensitivity = 100 // the amount the car sticks on the road
            let curve_length = 0.01

            let car_timer = 50

            let curve_offset = 0
            let LL = line_length
            let R = resolution
            let CT = car_timer
            let line = false

            let colors = ['#0000', '#f00', '#f80', '#000', '#fb5', '#08f', '#666', '#0005']

            let list_width = 13
            let list_height = 11
            let list = [0, 0, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0,
                        0, 0, 4, 5, 5, 5, 5, 5, 4, 0, 0, 0, 0,
                        0, 0, 4, 5, 5, 5, 5, 5, 4, 0, 0, 0, 0,
                        0, 0, 4, 5, 5, 5, 5, 5, 4, 0, 0, 0, 0,
                        4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0,
                        4, 1, 4, 4, 4, 4, 4, 4, 4, 1, 4, 0, 0,
                        4, 2, 4, 4, 4, 4, 4, 4, 4, 2, 4, 0, 0,
                        4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0,
                        4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0,
                        0, 6, 6, 0, 0, 0, 0, 0, 6, 6, 0, 0, 0,
                        7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]

            function draw_car(size, car) {
                let x = 0
                let y = 0

                let string = ''

                for (let v = 0; v < list.length; v ++) {
                    if (v % list_width == 0) {
                        y += size
                        x = 0
                    }

                    x += size
                    if (car.x == 0) string += 'ctx.fillStyle = "'+colors[list[v]]+'"; ctx.fillRect(segment.x + '+x+', segment.y - '+size * list_height+' + '+y+', '+size+', '+size+'); '
                    if (car.x == 1) string += 'ctx.fillStyle = "'+colors[list[v]]+'"; ctx.fillRect(segment.x + segment.size / 2 + '+x+', segment.y - '+size * list_height+' + '+y+', '+size+', '+size+'); '
                }

                return string
            }

            function random(min, max) {
                return Math.round(Math.random() * (max - min) + min)
            }

            function make_segments() {
                let x = point_x // add offset to x-position
                let y = point_y
                let size = 1

                segments.unshift({x, y, size, line}) // 'unshift' adds something to the start of a list
            }

            function resize() {
                c.width = innerWidth
                c.height = innerHeight

                point_x = innerWidth / 2
                point_y = innerHeight / 2

                curve_amount = innerWidth / 100

                segments = []
            }

            function start() {
                document.body.style.background = '#fff'
                document.body.style.margin = 0
                document.body.style.overflow = 'hidden'

                addEventListener('resize', resize)

                addEventListener('keydown', () => {
                    if (event.key == 'ArrowUp') key.up = true
                    if (event.key == 'ArrowLeft') key.left = true
                    if (event.key == 'ArrowRight') key.right = true
                })
                addEventListener('keyup', () => {
                    if (event.key == 'ArrowUp') key.up = false
                    if (event.key == 'ArrowLeft') key.left = false
                    if (event.key == 'ArrowRight') key.right = false
                })

                resize()
                loop()
            }

            function loop() {
                c.width = c.width
                c.style.background = '#588'

                if (key.up) {
                    curve_offset += curve_length
                    point_x += Math.sin(curve_offset) * (curve_amount * speed) // update offset
                    point_y += Math.cos(curve_offset) * (curve_amount * speed)

                    LL -= speed * 10
                    R -= speed * 10
                    CT -= speed * 10

                    if (LL < 0) {
                        line = true
                        if (LL < -line_length) {
                            LL = line_length
                            line = false
                        }
                    }

                    if (R < 0) {
                        make_segments()
                        for (let car of cars) {
                            car.index ++
                        }
                        R = resolution
                    }

                    if (CT < 0) {
                        cars.push({index: 0, speed: random(1, 9) / 10, x: random(0, 1)})
                        CT = car_timer
                    }
                }

                let dist_x = point_x - innerWidth / 2

                for (let segment of segments) {
                    if (segment.line) ctx.fillStyle = '#060'
                    else ctx.fillStyle = '#070'
                    ctx.fillRect(0, segment.y, innerWidth, segment.size / 10)

                    let next = segments.indexOf(segment) + 1

                    if (next > segments.length - 1) {
                        next = segments.length - 1
                    }

                    // ROAD
                    ctx.beginPath()
                    ctx.fillStyle = '#333'
                    ctx.moveTo(segment.x, segment.y - 1)
                    ctx.lineTo(segment.x + segment.size, segment.y - 1)
                    ctx.lineTo(segments[next].x + segments[next].size, segments[next].y)
                    ctx.lineTo(segments[next].x, segments[next].y)
                    ctx.fill()

                    // HARD SHOULDER
                    ctx.beginPath()
                    if (segment.line) ctx.fillStyle = '#555'
                    else ctx.fillStyle = '#444'
                    ctx.moveTo(segment.x, segment.y - 1)
                    ctx.lineTo(segment.x + segment.size / line_width, segment.y - 1)
                    ctx.lineTo(segments[next].x + segments[next].size / line_width, segments[next].y)
                    ctx.lineTo(segments[next].x, segments[next].y)

                    ctx.moveTo(segment.x + segment.size - segment.size / line_width, segment.y - 1)
                    ctx.lineTo(segment.x + segment.size, segment.y - 1)
                    ctx.lineTo(segments[next].x + segments[next].size, segments[next].y)
                    ctx.lineTo(segments[next].x + segments[next].size - segments[next].size / line_width, segments[next].y)
                    ctx.fill()

                    // LINE
                    if (segment.line) {
                        ctx.beginPath()
                        ctx.fillStyle = '#fff'
                        ctx.moveTo(segment.x + segment.size / 2 - segment.size / line_width, segment.y - 1)
                        ctx.lineTo(segment.x + segment.size / 2 + segment.size / line_width, segment.y - 1)
                        ctx.lineTo(segments[next].x + segments[next].size / 2 + segments[next].size / line_width, segments[next].y)
                        ctx.lineTo(segments[next].x + segments[next].size / 2 - segments[next].size / line_width, segments[next].y)
                        ctx.fill()
                    }

                    // CAR
                    for (let car of cars) {
                        if (Math.round(car.index) == segments.indexOf(segment)) {
                            eval(draw_car(segment.size / 30, car))

                            car.index -= car.speed
                        }
                    }

                    if (key.up) {
                        segment.size *= 1 + speed
                        segment.y += (segment.size * camera_height) * speed

                        segment.x += (dist_x / (curve_insensitivity / speed)) * segment.size // drift off road
                    }

                    if (key.left) {
                        segment.x += 5

                        point_x += (5) / segments.length
                    }
                    if (key.right) {
                        segment.x -= 5

                        point_x -= (5) / segments.length
                    }

                    if (segment.y > innerHeight + (segment.size * camera_height) * speed * resolution) { // remove segments off bottom of screen
                        segments.splice(segments.indexOf(segment), 1)
                    }
                }

                for (car of cars) {
                    if (car.index > segments.length) cars.splice(cars.indexOf(car), 1)
                }

                requestAnimationFrame(loop)
            }

            start()
        </script>
    </body>
</html>