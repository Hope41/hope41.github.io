<!DOCTYPE html>
    <head>
        <title>Drive</title>
        <meta charset = utf-8>

        <script src = ../../main.js></script>
        <link rel = stylesheet href = ../../main.css>
    </head>

    <body>
        <section class = main>
<div class = code>
<pre>
&lt;!DOCTYPE html&gt;
    &lt;head&gt;
        &lt;meta charset = utf-8&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id = c&gt;&lt;/canvas&gt;
        &lt;script&gt;
            let ctx = c.getContext('2d')

            let segments = []
            let key = {up: false, left: false, right: false}
            let point_x = innerWidth / 2 // define offset (the point where segments are emitted)
            let point_y = innerHeight / 2

            let resolution = 0

            let speed = 0.1
            let camera_height = 0.2

            let line_length = 0.5
            let line_width = 20

            let curve_amount = 40
            let curve_insensitivity = 100 // the amount the car sticks on the road
            let curve_length = 0.01

            let curve_offset = 0
            let LL = line_length
            let R = resolution
            let line = false

            function random(min, max) {
                return Math.round(Math.random() * (max - min) + min)
            }

            function make_segments() {
                let x = point_x // add offset to x-position

                let y = point_y
                let size = 1

                segments.unshift({x, y, size, line}) // 'unshift' adds something to the start of a list
            }

            function resize() {
                c.width = innerWidth
                c.height = innerHeight

                point_x = innerWidth / 2
                point_y = innerHeight / 2

                segments = []
            }

            function start() {
                document.body.style.background = '#fff'
                document.body.style.margin = 0
                document.body.style.overflow = 'hidden'

                addEventListener('resize', resize)

                addEventListener('keydown', () => {
                    if (event.key == 'ArrowUp') key.up = true
                    if (event.key == 'ArrowLeft') key.left = true
                    if (event.key == 'ArrowRight') key.right = true
                })
                addEventListener('keyup', () => {
                    if (event.key == 'ArrowUp') key.up = false
                    if (event.key == 'ArrowLeft') key.left = false
                    if (event.key == 'ArrowRight') key.right = false
                })

                resize()
                loop()
            }

            function loop() {
                c.width = c.width
                c.style.background = '#588'

                if (key.up) {
                    curve_offset += curve_length
                    point_x += Math.sin(curve_offset) * (curve_amount * speed) // update offset
                    point_y += Math.cos(curve_offset)

                    LL -= speed
                    if (LL < 0) {
                        line = true
                        if (LL < -line_length) {
                            LL = line_length
                            line = false
                        }
                    }

                    R -= speed * 10

                    if (R < 0) {
                        make_segments()
                        R = resolution
                    }
                }

                let dist_x = point_x - innerWidth / 2

                for (let segment of segments) {
                    if (segment.line) ctx.fillStyle = '#0007'
                    else ctx.fillStyle = '#0004'
                    ctx.fillRect(0, segment.y, innerWidth, segment.size / 100)

                    let next = segments.indexOf(segment) + 1

                    if (next > segments.length - 1) {
                        next = segments.length - 1
                    }

                    ctx.beginPath()
                    ctx.fillStyle = '#333'
                    ctx.moveTo(segment.x, segment.y - 1)
                    ctx.lineTo(segment.x + segment.size, segment.y - 1)
                    ctx.lineTo(segments[next].x + segments[next].size, segments[next].y)
                    ctx.lineTo(segments[next].x, segments[next].y)
                    ctx.fill()

                    ctx.beginPath()
                    if (segment.line) ctx.fillStyle = '#555'
                    else ctx.fillStyle = '#444'
                    ctx.moveTo(segment.x, segment.y - 1)
                    ctx.lineTo(segment.x + segment.size / line_width, segment.y - 1)
                    ctx.lineTo(segments[next].x + segments[next].size / line_width, segments[next].y)
                    ctx.lineTo(segments[next].x, segments[next].y)

                    ctx.moveTo(segment.x + segment.size - segment.size / line_width, segment.y - 1)
                    ctx.lineTo(segment.x + segment.size, segment.y - 1)
                    ctx.lineTo(segments[next].x + segments[next].size, segments[next].y)
                    ctx.lineTo(segments[next].x + segments[next].size - segments[next].size / line_width, segments[next].y)
                    ctx.fill()

                    if (segment.line) {
                        ctx.beginPath()
                        ctx.fillStyle = '#fff'
                        ctx.moveTo(segment.x + segment.size / 2 - segment.size / line_width, segment.y - 1)
                        ctx.lineTo(segment.x + segment.size / 2 + segment.size / line_width, segment.y - 1)
                        ctx.lineTo(segments[next].x + segments[next].size / 2 + segments[next].size / line_width, segments[next].y)
                        ctx.lineTo(segments[next].x + segments[next].size / 2 - segments[next].size / line_width, segments[next].y)
                        ctx.fill()
                    }

                    if (key.up) {
                        segment.size *= 1 + speed
                        segment.y += (segment.size * camera_height) * speed

                        segment.x += (dist_x / (curve_insensitivity / speed)) * segment.size // drift off road
                    }

                    if (key.left) {
                        segment.x += innerWidth / 200

                        point_x += (innerWidth / 200) / segments.length
                    }
                    if (key.right) {
                        segment.x -= innerWidth / 200

                        point_x -= (innerWidth / 200) / segments.length
                    }

                    if (segment.y > innerHeight + (segment.size * camera_height) * speed * resolution) { // remove segments off bottom of screen
                        segments.splice(segments.indexOf(segment), 1)
                    }
                }

                requestAnimationFrame(loop)
            }

            start()
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</div>
</pre>
        </section>
    </body>
</html>