<!DOCTYPE html>
    <head>
        <title>Drive</title>
        <meta charset = utf-8>

        <script src = ../../../main.js></script>
        <link rel = stylesheet href = ../../../main.css>
    </head>

    <body>
        <section class = main>
<div class = code>
<pre>
&lt;!DOCTYPE html&gt;
    &lt;head&gt;
        &lt;meta charset = utf-8&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id = c&gt;&lt;/canvas&gt;
        &lt;script&gt;
            let ctx = c.getContext('2d')
            addEventListener('keydown', press)
            addEventListener('keyup', unpress)
            addEventListener('resize', resize)
            oncontextmenu = e => e.preventDefault()

            let key = {space: false}
            let damping = .97
            let gravity = .9
            let x_bounce = .5
            let y_bounce = .3
            let y_force = 10

            let bumps = []
            let curve = 0

            class Camera {
                constructor(x, y) {
                    this.x = x
                    this.y = y
                }

                update() {
                    this.x += (hero.x - this.x) / 10
                    this.y += (hero.y - this.y) / 10
                }

                get offset_x() {return this.x - innerWidth / 2}
                get offset_y() {return this.y - innerHeight / 2}
                get left() {return this.x - innerWidth / 2}
                get right() {return this.x + innerWidth / 2}
            }

            class Car {
                constructor(car) {
                    this.x = car.x
                    this.y = car.y
                    this.speed_x = car.speed_x
                    this.speed_y = car.speed_y
                    this.radius = car.radius
                    this.angle = car.angle
                    this.collide = car.collide
                }

                calculate() {
                    this.x += this.speed_x
                    this.y += this.speed_y

                    this.speed_y += gravity

                    this.speed_x *= damping
                    this.speed_y *= damping

                    if (!this.collide) {
                        this.angle += .05
                    }
                }

                collision(i) {
                    if (this.x >= i.x && this.x <= i.X) {
                        let line_angle = Math.atan2(i.Y - i.y, i.X - i.x) // angle of line
                        let dx = i.X - this.x // x distance from right of line to ball
                        let dy = i.Y - this.y // y distance from right of line to ball
                        let point_angle = Math.atan2(dy, dx) // angle of point from right of line
                        let point_line = point_angle - line_angle // angle from point_angle to line_angle
                        let distance = Math.sqrt(dx ** 2 + dy ** 2) // distance from point to right of line to ball
                        let length = Math.sin(point_line) * distance - this.radius// amount ball needs to move

                        if (length < 0) {
                            let x = Math.cos(line_angle + Math.PI / 2) * length
                            let y = Math.sin(line_angle + Math.PI / 2) * length

                            this.x += x
                            this.y += y
                            
                            this.speed_x += x * x_bounce
                            this.speed_y += y * y_bounce

                            this.collide = true

                            this.angle = line_angle
                        }
                    }
                }
            }

            let hero = new Car({x: innerWidth, y: 0, speed_x: 10, speed_y: 0, radius: 10, angle: 0, collide: false})

            let camera = new Camera(0, 0)

            function press() {
                if (event.key == ' ') key.space = true
            }

            function unpress() {
                if (event.key == ' ') key.space = false
            }

            function random(min, max) {
                return Math.round(Math.random() * (max - min) + min)
            }

            function make() {
                curve += .1

                let X = camera.right
                let Y = 300 + Math.sin(Math.sin(curve / 3) * Math.cos(curve) + Math.cos(curve / 5) * 10) * (100 + Math.sin(curve / 30) * 70)
                let x = bumps.length ? bumps[bumps.length - 1].X : 0
                let y = bumps.length ? bumps[bumps.length - 1].Y : 0

                bumps.push({X, Y, x, y})
            }

            function resize() {
                c.width = innerWidth
                c.height = innerHeight
            }

            function start() {
                document.body.style.background = '#fff'
                document.body.style.margin = 0
                document.body.style.overflow = 'hidden'
                c.style.background = '#8ff'

                resize()
                make()
            }

            function loop() {
                c.width = c.width

                if (bumps[bumps.length - 1].X < camera.right - 10) make()
                if (bumps[0].x < camera.left) bumps.splice(0, 1)

                hero.collide = false
                
                for (let i of bumps) {
                    hero.collision(i)

                    ctx.fillStyle = '#000'
                    ctx.beginPath()
                    ctx.lineWidth = 2
                    ctx.moveTo(i.x - camera.offset_x, i.y - camera.offset_y)
                    ctx.lineTo(i.X - camera.offset_x, i.Y - camera.offset_y)
                    ctx.stroke()
                }

                hero.calculate()

                if (hero.collide) {
                    if (key.space) {
                        hero.speed_x += 1

                        if (hero.speed_x > 1) {
                            hero.speed_y -= y_force / Math.abs(hero.speed_x)
                        }
                        else hero.speed_x += 5
                    }
                }

                camera.update()

                ctx.beginPath()
                ctx.save()
                ctx.translate(hero.x - camera.offset_x, hero.y - camera.offset_y)
                ctx.rotate(hero.angle)
                ctx.fillStyle = '#444'
                ctx.fill(ctx.arc(-12, 0, hero.radius, 0, 7))
                ctx.fill(ctx.arc(12, 0, hero.radius, 0, 7))
                ctx.fillStyle = '#29b'
                ctx.fillRect(-15, -20, 30, 20)
                ctx.restore()

                requestAnimationFrame(loop)
            }

            start()
            loop()
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</div>
</pre>
        </section>
    </body>
</html>