<!DOCTYPE html>
<html>
    <head>
        <meta charset = utf-8>
        <meta name = viewport content = 'width = device-width, initial-scale = 1'>
        <meta name = keywords content = 'Joachim Ford, JavaScript ray caster, JavaScript 3d'>

        <script async src = 'https://www.googletagmanager.com/gtag/js?id=G-2MDQ9F697V'></script>
        <script src = /js/analytics.js></script>
        <script src = /js/main.js></script>
        <title>Joachim Ford</title>
        <link rel = stylesheet href = /main.css>
    </head>

    <body>
        <section class = topnav>
            <div class = joachimford>
                <a href = '/'>Joachim Ford</a>
            </div>
            <div class = nav>
                <a class = text href = /games>Games</a>
                <a class = text href = /articles>Articles</a>
                <a class = text href = /news>News</a>
                <a class = text href = /experiments>Experiments</a>
                <a class = text href = https://github.com/Hope41 target = _blank><img src = /svg/github.svg></img></a>
                <a class = text href = mailto:hello@joachimford.uk><img src = /svg/mail.svg></img></a>
            </div>
            <img class = bars src = /svg/bars.svg onmousedown = bar()></img>
        </section>

        <section class = main>
            <span class = date>27.03.2022</span>
            <h1>Ray Casting Blocks</h1>
            <div class = big>
                <a href = /ray-casting-city target = _blank>
                    <img class = img src = /images/ray_casting_city_big.png>
                    <div class = play><img src = /svg/play.svg></svg></div>
                </a>
            </div>
            <div class = quote>
                <b>A lively run through an infinite procedural city.
                Initially developed throughout March 2022, but later updated in late 2023.
                </b>
            </div>
            <span class = gap>
                Here is the complete source code:
            </span>
            <div class = code source = /ray-casting-city></div>
            <span class = gap>
                I must say, although this experiment was very fun to make,
                ray casting is actually quite limited when it comes to flexability.
                That's why nowadays a lot of people have turned to methods like ray tracing, ray marching,
                and other things which have been able to extend the limitations of ray casting.
                It's still an awesome tool though, and I recommend it to anyone who's
                new to coding in three dimentions (like me.)
                <p></p>
                The concept of a ray-caster is really simple.
                Although it looks 3D, it really only uses 2D logic and then converts it
                to 3D at the end. Here is how it works in <div class = snip>Three Easy Steps</div>.
                <p></p>
                <h3>~ STEP 1 ~</h3>

                Create a bunch of rays (or "lines" if you prefer), but make sure
                each ray stops when it hits an obstacle.
            </span>

            <div class = iframe source = extra/ray_casting_city/1.html></div>
            <div class = code>for (let j = 0; j < rayItr; j ++) {
    length = j * rayJmp

    x += Math.cos(ang) * rayJmp
    y += Math.sin(ang) * rayJmp

    if (map.a[Math.floor(x) + Math.floor(y) * map.w] > 0)
        break
}</div>
            <span class = gap>
                <h3>~ STEP 2 ~</h3>

                On your real screen, draw a rectangle for each ray you have. Its
                position is based on the ray you're dealing with.
                Its height is determined by the length of the ray.
            </span>

            <div class = code>ray on the left = rectangle on the left
longer ray = shorter rectangle</div>

            <span class = gap>
                This is what it looks like. Not the most amazing graphics, I admit.
            </span>
            <div class = iframe source = extra/ray_casting_city/2.html></div>
            <div class = code>const w = cvs.width / rayAmt
const h = 10 / length * scale
const s = 100 / length

ctx.fillStyle = 'rgb('+s+','+s+','+s+')'
ctx.fillRect(i * w, cvs.height / 2 - h / 2, w, h)</div>
            <span class = gap>
                <h3>~ STEP 3 ~</h3>

                Well, no matter what you think of it, you have already created a ray
                casted scene. That wasn't so hard was it?
                <p></p>
                Ray casting can actually be really
                useful for certain types of games. A taxi delivery game or a maze would work
                well, or even an FPS, if you like that kind of thing!
                <p></p>
                All we need now is more rays! I've also moved the camera (which is
                basically just the starting point of the rays) to help
                you get a better picture of what's happening.
            </span>

            <div class = iframe source = extra/ray_casting_city/3.html></div>

            <span class = gap>
                This is the source code for the demo above. It's surprisingly short, actually.
            </span>

            <div class = code source = extra/ray_casting_city/3.html></div>

            <span class = gap>
                <h3>"It's surprisingly short, actually"</h3>

                After writing that last sentence, I decided to really see how short
                I could get the above example. Turns out, the entire code can sit
                quite happily at 273 characters.
                You can try getting it even smaller if you like!
            </span>

            <div class = iframe source = extra/ray_casting_city/4.html></div>
            <div class = code source = extra/ray_casting_city/4.html></div>

            <span class = gap>
                Anyway, hopefully this page was slightly helpful, and maybe I'll
                make something big using ray casting in the future. It's pretty
                hard to overcome the initial limitations of ray casting, but if you can do it,
                it's a great trick to have up your sleeve!
            </span>
        </section>

        <span class = copyright>
            © Copyright <span class = year></span>
            Joachimford.uk — <a class = normal href = mailto:contact@joachimford.uk>contact@joachimford.uk</a>
        </span>
    </body>
</html>
