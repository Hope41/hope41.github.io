<!DOCTYPE html>
<html>
    <head>
        <meta charset = utf-8>
        <meta name = viewport content = 'width = device-width, initial-scale = 1'>
        <meta name = keywords content = 'Joachim Ford, JavaScript games, Squirtcopter'>

        <script async src = 'https://www.googletagmanager.com/gtag/js?id=G-2MDQ9F697V'></script>
        <script src = /js/analytics.js></script>
        <script src = /js/main.js></script>
        <title>Joachim Ford</title>
        <link rel = stylesheet href = /main.css>
        <link rel = icon type = image/x-icon  href = /favs/favicon.ico>
        <style>
            html {height: 100%}

            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                width: 100%;
                height: 100%;
                max-width: none;
            }

            canvas {
                width: 100%;
                height: 100%;
            }

            .main {
                margin: 0;
                padding: 0;
                max-width: none;
            }
        </style>
    </head>

    <body>
        <section class = topnav>
            <div class = title>
                <a class = brand href = '/'>Joachim Ford</a>
                <a class = about href = /about>About</a>
            </div>
            <div class = nav>
                <a href = /games>Games</a>
                <a href = /experiments>Experiments</a>
                <a href = /articles>Articles</a>
                <a href = /news>News</a>
            </div>
        </section>

        <section class = main>
            <a href = /content/squirtcopter><canvas id = cvs></canvas></a>
            <script>
                function resize() {
                    cvs.width = innerWidth * devicePixelRatio
                    cvs.height = innerHeight * devicePixelRatio + 1

                    box = cvs.width
                    if (cvs.width > cvs.height) box = cvs.height
                }

                function rgb(r, g, b, a = 1) {
                    return 'rgb('+(r*255)+','+(g*255)+','+(b*255)+','+a+')'
                }

                function quad(x) {
                    return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2
                }

                function update() {
                    ctx.clearRect(0, 0, cvs.width, cvs.height)
                    time += 1.2

                    const iRatio = img.width / img.height
                    const cRatio = cvs.width / cvs.height
                    let w = 0
                    let h = 0
                    if (iRatio < cRatio) {
                        w = cvs.width
                        h = (img.height / img.width) * cvs.width
                    }
                    else {
                        w = iRatio * cvs.height
                        h = cvs.height
                    }
                    ctx.drawImage(
                        img,
                        cvs.width / 2 - w / 2,
                        cvs.height / 2 - h / 2 + 60 * devicePixelRatio,
                        w, h)

                    ctx.fillStyle = rgb(0,0,0,.4)
                    ctx.fillRect(0, 0, cvs.width, cvs.height)

                    for (let j = 0; j < booms.length; j ++) {
                        const item = booms[j]
                        const sum = time - item.time
                        if (sum > 0) {
                            const add = box * 3
                            const S = (add * item.size)
                            const gap = S * .82
                            const size = item.name.length * gap
                            let summ = sum
                            const check = time - item.expire
                            if (item.expire && check > item.time) {
                                summ = 20 - (check - item.time)
                                if (summ < 0) summ = 0
                            }

                            for (let i = 0; i < item.name.length; i ++) {
                                ctx.font = S + 'px pixelMonospace, sans-serif'
                                const posX = item.x * (add * .7) + cvs.width / 2 - add / 6.5
                                const posY = item.y * (add * .3) + cvs.height / 2 + 100 - add / 40
                                const shake = 99 / (summ * summ * .5) * 5

                                if (shake > 8) {
                                    let r = Math.sin(i*i*9*j)
                                    let g = Math.sin(i*i*i*i*j*j*9)
                                    let b = Math.sin(i*i*i**j)

                                    ctx.fillStyle = rgb(r,g,b,summ/5-(Math.sin(i*i)+1))

                                    ctx.fillText(
                                        item.name[i],
                                        posX + i * gap - Math.cos(summ) * shake,
                                        posY - Math.sin(summ) * shake)
                                }

                                ctx.fillStyle = rgb(1,1,1,summ/3-(Math.sin(i*i)+1))

                                ctx.fillText(
                                    item.name[i],
                                    posX + i * gap + Math.cos(summ) * shake,
                                    posY + Math.sin(summ) * shake)
                            }
                        }
                    }

                    ctx.fillStyle = rgb(1,1,.4,
                        Math.sin(time / 240 +
                        Math.cos(time / 130) * 2 +
                        Math.sin(time / 10) * .1) * .05)

                    ctx.fillRect(
                        cvs.width / 2 + Math.sin(time / 300 + Math.cos(time / 500)) * cvs.width / 3,
                        cvs.height / 2 + Math.cos(time / 230 + Math.sin(time / 550)) * cvs.height / 3,
                        box * .03,
                        box * .03
                    )

                    requestAnimationFrame(update)
                }

                const ctx = cvs.getContext('2d')
                let time = 0
                let box = 0

                const img = new Image()
                img.src = 'images/bg.png'

                const booms = [
                    {name: 'SQUIRTCOPTER', time: 70, x: 0, y: 0, size: .03, expire: 215},
                    {name: 'By Joachim Ford', time: 75, x: 0, y: .1, size: .01, expire: 200},
                    {name: 'EMBARK', time: 350, x: 0, y: -.2, size: .03, expire: 215},
                    {name: 'ON', time: 370, x: .3, y: -.2, size: .03, expire: 200},
                    {name: 'A', time: 380, x: .4, y: -.2, size: .03, expire: 195},
                    {name: 'QUEST', time: 400, x: .1, y: .1, size: .04, expire: 180},
                    {name: 'SQUIRT', time: 650, x: 0, y: -.2, size: .03, expire: 215},
                    {name: 'YOUR', time: 670, x: .24, y: -.2, size: .03, expire: 200},
                    {name: 'WAY', time: 680, x: .35, y: -.05, size: .03, expire: 190},
                    {name: 'TO', time: 700, x: .05, y: 0, size: .04, expire: 185},
                    {name: 'VICTORY', time: 710, x: .05, y: .2, size: .04, expire: 200},
                    {name: 'PLAY NOW', time: 1010, x: .08, y: 0, size: .03, expire: 200},
                    {name: 'SQUIRTCOPTER', time: 1300, x: 0, y: 0, size: .03, expire: 0},
                    {name: 'By Joachim Ford', time: 1305, x: 0, y: .1, size: .01, expire: 0},
                ]

                addEventListener('resize', resize)
                resize()
                update()
            </script>
        </section>

        <button class = theme onclick = toggleTheme()>Change Theme</button>
        <span class = copyright>
            Â© Copyright <span class = year></span> joachimford.uk
            <a href = https://github.com/Hope41 target = _blank><img src = /svg/github.svg></img></a>
            <a href = mailto:hello@joachimford.uk><img src = /svg/mail.svg></img></a>
        </span>
    </body>
</html>