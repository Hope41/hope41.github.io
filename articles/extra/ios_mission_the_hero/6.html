<!DOCTYPE html>
<html>
    <head>
        <style>
            body {
                background: #fff;
                margin: 0;
                overflow: hidden
            }

            canvas {
                width: 100%;
            }
        </style>
    </head>
    <body>
        <canvas id = cvs></canvas>
        <script>
            function resize() {
                cvs.width = innerWidth * devicePixelRatio
                cvs.height = innerHeight * devicePixelRatio

                s = cvs.height / 9
            }

            function createBody() {
                return {
                    arm1: 0,
                    arm2: 0,
                    leg1: 0,
                    leg2: 0,
                    eyex: 0,
                    eyey: 0,
                    body: 0,
                    ang: 0
                }
            }

            const arr = [
                'arm1',
                'arm2',
                'leg1',
                'leg2',
                'eyex',
                'eyey',
                'body',
                'ang'
            ]

            let hero = createBody()

            let activeState = 'walking'
            let oldState = ''
            let transition = 0

            function live(inputState) {
                const bod = createBody()

                if (inputState == 'walking') {
                    const sway = .3 + Math.cos(time / 5) * .05
                    bod.arm1 = -.5
                    bod.arm2 = .5
                    bod.leg1 = Math.sin(time / 10) * .5 - sway
                    bod.leg2 = Math.sin(time / 10 + Math.PI) * .5 - sway
                    bod.eyex = .2
                    bod.ang = sway
                    bod.body = 1.5
                }

                else if (inputState == 'climbing') {
                    bod.arm1 = 1.3 + Math.sin(time / 10) * .5
                    bod.arm2 = 1.3 + Math.sin(time / 10 + Math.PI) * .5

                    bod.leg1 = 1 + Math.sin(time / 10) * .5
                    bod.leg2 = 1 + Math.sin(time / 10 + Math.PI) * .5

                    bod.ang = Math.cos(time / 10) * .05

                    bod.eyex = -.2
                    bod.body = 1.5
                }

                return bod
            }

            function update() {
                requestAnimationFrame(update)

                time += 1

                // get old and new hero states
                const oldBody = live(oldState)
                const newBody = live(activeState)

                // transition if has not met goal
                if (oldState != activeState) {
                    transition += .02

                    // reset transition if finished
                    if (transition >= 1) {
                        transition = 0
                        oldState = activeState
                    }

                    // iterate through all the body parts
                    for (let i = 0; i < arr.length; i ++) {
                        const oldPart = oldBody[arr[i]]
                        const newPart = newBody[arr[i]]
                        const dist = newPart - oldPart

                        // change the hero's joints
                        hero[arr[i]] = oldPart + (dist * (.5 + Math.cos(transition * Math.PI + Math.PI) * .5))
                    }
                }

                // set straight away if not transitioning
                if (!transition)
                    hero = newBody

                // change hero state when ready
                if (time % 200 < 1) {
                    if (activeState == 'walking')
                        activeState = 'climbing'
                    else activeState = 'walking'
                }

                // draw hero ect...
                ctx.fillStyle = '#bfd'
                ctx.fillRect(0, 0, cvs.width, cvs.height)
                const rect = (x, y, w, h) => ctx.fillRect(x - w / 2, y, w, h)
                const heady = 2
                const head = 2
                const thick = .2
                const main = head - thick * 2
                const eyes = .6
                const pupw = .2
                const pups = .5
                const len = 1.3
                const start = cvs.height / 2 - heady*s + head*s
                const y = -head*s + s / 1.5
                ctx.save()
                ctx.translate(cvs.width / 2, cvs.height / 2)
                ctx.rotate(hero.ang)
                ctx.fillStyle = '#222'
                rect(0, 0, thick*s, hero.body*s)
                ctx.save()
                ctx.translate(0, 0)
                ctx.rotate(hero.arm1)
                rect(0, -heady*s + head*s, thick*s, s * len)
                ctx.restore()
                ctx.save()
                ctx.translate(0, 0)
                ctx.rotate(hero.arm2)
                rect(0, -heady*s + head*s, thick*s, s * len)
                ctx.restore()
                ctx.save()
                ctx.translate(0, hero.body*s)
                ctx.rotate(hero.leg1)
                rect(0, 0, thick*s, s * len)
                ctx.restore()
                ctx.save()
                ctx.translate(0, hero.body*s)
                ctx.rotate(hero.leg2)
                rect(0, 0, thick*s, s * len)
                ctx.restore()
                ctx.fillStyle = '#222'
                rect(0, -heady*s, head*s, head*s)
                ctx.fillStyle = '#fff'
                rect(0, -heady*s + (head-main)*s/2, main*s, main*s)
                ctx.fillStyle = '#222'
                rect(-s / 3.5 + hero.eyex*s,
                    y + eyes*s/2 - pups*s/2 + hero.eyey*s,
                    s*pupw, pups*s)
                rect(s / 3.5 + hero.eyex*s,
                    y + eyes*s/2 - pups*s/2 + hero.eyey*s,
                    s*pupw, pups*s)
                ctx.restore()
            }

            const ctx = cvs.getContext('2d')
            let time = 0
            let s = 0

            addEventListener('resize', resize)
            resize()
            update()
        </script>
    </body>
</html>